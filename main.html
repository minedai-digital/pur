<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تطبيق التوريدات</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      background: #f0f2f5;
      color: #333;
    }
    header {
      background: #007bff;
      color: #fff;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
    }
    .container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .top-inputs {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    label {
      font-weight: 600;
      font-size: 14px;
      display: flex;
      flex-direction: column;
    }
    input {
      padding: 7px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #e5e5e5;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background: #f8f9fa;
    }
    tfoot td {
      font-weight: bold;
      background: #f1f3f5;
    }
    .highlight {
      background-color: #d4edda !important;
    }
    .controls, .footer-actions {
      margin-top: 20px;
      text-align: center;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      margin: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: 0.2s;
    }
    button:hover { opacity: 0.85; }
    .add { background: #007bff; color: #fff; }
    .clear { background: #dc3545; color: #fff; }
    .next { background: #28a745; color: #fff; }
    .save { background: #17a2b8; color: #fff; }
    .load { background: #6f42c1; color: #fff; }
    .footer-inputs {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
      gap: 15px;
    }

    /* ⚡ جعل الصفحة متناسقة مع الموبايل */
    @media (max-width: 768px) {
      header {
        font-size: 18px;
      }
      table th, table td {
        font-size: 12px;
        padding: 6px;
      }
      button {
        font-size: 12px;
        padding: 8px 12px;
      }
    }
  </style>
</head>





<!-- ضع هذا الكود أسفل وسم <body> مباشرة قبل <header> -->
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-logo"> تطبيق المشتريات</div>
    <ul class="nav-links">

      <li><a href="main.html">الرئيسية</a></li>
      <li><a href="taw.html">التوريد</a></li>
      <li><a href="taf.html">تفريغ</a></li>
      <li><a href="mahdr.html">محضر</a></li>
      <li><a href="talab.html">طلب</a></li>
      <li><a href="moka.html">مقايسه</a></li>
      <li><a href="tash.html">تشكيل</a></li>
      <li><a href="custom.html">الضرايب</a></li>
    </ul>
    <div class="nav-toggle" onclick="toggleMenu()">☰</div>
  </div>
</nav>

<style>
/* Navbar أساسي */
.navbar {
  background-color: #007bff;
  color: #fff;
  font-family: 'Cairo', sans-serif;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.nav-container {
  max-width: 1200px;
  margin: auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
}

.nav-logo {
  font-size: 20px;
  font-weight: bold;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 15px;
  margin: 0;
  padding: 0;
}

.nav-links li a {
  color: #fff;
  text-decoration: none;
  font-weight: 600;
  padding: 8px 12px;
  border-radius: 6px;
  transition: background 0.2s;
}

.nav-links li a:hover {
  background-color: rgba(255,255,255,0.2);
}

.nav-toggle {
  display: none;
  font-size: 24px;
  cursor: pointer;
}

/* تصميم متجاوب */
@media (max-width: 768px) {
  .nav-links {
    display: none;
    flex-direction: column;
    gap: 10px;
    background-color: #007bff;
    padding: 10px 0;
  }
  .nav-links.active {
    display: flex;
  }
  .nav-toggle {
    display: block;
  }
}
</style>

<script>
function toggleMenu() {
  document.querySelector('.nav-links').classList.toggle('active');
}
</script>








<body>

  <header>نموذج البيانات الاساسية </header>

  <div class="container">

    <!-- العناوين العلوية -->
    <div class="top-inputs">
      <label>📅 التاريخ: <input type="date" id="date"></label>
      <label>المورد الأول: <input list="suppliersList" id="supplier1" oninput="updateSupplierHeaders()"></label>
      <label>المورد الثاني: <input list="suppliersList" id="supplier2" oninput="updateSupplierHeaders()"></label>
      <label>المورد الثالث: <input list="suppliersList" id="supplier3" oninput="updateSupplierHeaders()"></label>
      <label>تاريخ اللجنة: <input type="date" id="committeeDate"></label>
      <label>نسبة الضريبة %: <input type="number" id="taxRate" value="0" oninput="updateTotals()"></label>
    </div>

    <!-- الجدول الرئيسي -->
    <table id="itemsTable">
      <thead>
        <tr>
          <th>م</th>
          <th>اسم الصنف</th>
          <th>الوحدة</th>
          <th>الكمية</th>
          <th id="th-supplier1">سعر المورد الأول</th>
          <th id="th-supplier2">سعر المورد الثاني</th>
          <th id="th-supplier3">سعر المورد الثالث</th>
          <th>ملاحظات</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="4">الإجمالي</td>
          <td id="total1">0</td>
          <td id="total2">0</td>
          <td id="total3">0</td>
          <td colspan="2"></td>
        </tr>
      </tfoot>
    </table>

    <div class="controls">
      <button class="add" onclick="addRow()">➕ إضافة صف</button>
      <button class="clear" onclick="clearTable()">🗑️ مسح الكل</button>
<button class="next" onclick="goToTaw()">➡️ انتقال</button>  
  </div>

    <!-- الحقول أسفل الصفحة -->
    <div class="footer-inputs">
      <label><input list="staffList" placeholder="المختص"></label>
      <label><input list="staffList" placeholder="رئيس القسم"></label>
      <label><input list="staffList" placeholder="يعتمد"></label>
      <label><input list="staffList" placeholder="المدير المالي والإداري"></label>
      <label><input list="staffList" placeholder="اسم اللجنة الأول"></label>
      <label><input list="staffList" placeholder="اسم اللجنة الثاني"></label>
      <label><input list="staffList" placeholder="اسم اللجنة الثالث"></label>
      <label><input list="staffList" placeholder="مقدمه لسيادتكم"></label>
      <label><input list="staffList" placeholder="أمر الدفع بإسم"></label>
    </div>

    <!-- أزرار الحفظ والاسترجاع -->
    <div class="footer-actions">
      <button class="save" onclick="saveData()">💾 حفظ البيانات</button>
      <button class="load" onclick="loadData()">📂 استرجاع البيانات</button>
    </div>

  </div>

  <!-- datalists -->
  <datalist id="suppliersList"></datalist>
  <datalist id="itemsList"></datalist>
  <datalist id="staffList"></datalist>

  <script src="data.js"></script>
  <script>
    // تحميل الموردين
    Object.keys(suppliers).forEach(name => {
      let option = document.createElement("option");
      option.value = name;
      document.getElementById("suppliersList").appendChild(option);
    });

    // تحميل الأصناف
    Object.keys(itemsDB).forEach(item => {
      let option = document.createElement("option");
      option.value = item;
      document.getElementById("itemsList").appendChild(option);
    });

    // تحميل الموظفين
    staffDB.forEach(staff => {
      let option = document.createElement("option");
      option.value = staff;
      document.getElementById("staffList").appendChild(option);
    });

    let rowCount = 0;

    function addRow() {
      rowCount++;
      const tbody = document.querySelector("#itemsTable tbody");
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${rowCount}</td>
        <td><input list="itemsList" oninput="fillUnit(this)"></td>
        <td><input readonly></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input></td>
        <td><button onclick="removeRow(this)">مسح</button></td>
      `;
      tbody.appendChild(tr);
    }

    function removeRow(btn) {
      btn.closest("tr").remove();
      updateTotals();
    }

    function clearTable() {
  // مسح الجدول
  document.querySelector("#itemsTable tbody").innerHTML = "";
  rowCount = 0;
  updateTotals();

  // مسح المربعات العلوية
  document.getElementById("date").value = "";
  document.getElementById("supplier1").value = "";
  document.getElementById("supplier2").value = "";
  document.getElementById("supplier3").value = "";
  document.getElementById("committeeDate").value = "";
  document.getElementById("taxRate").value = "0";

  // تحديث العناوين بعد المسح
  updateSupplierHeaders();

  // مسح الحقول السفلية
  document.querySelectorAll(".footer-inputs input").forEach(inp => inp.value = "");
}


    function fillUnit(input) {
      const val = input.value;
      if (itemsDB[val]) {
        input.parentElement.nextElementSibling.querySelector("input").value = itemsDB[val].unit;
      }
    }

    function updateTotals() {
      const tax = parseFloat(document.getElementById("taxRate").value) || 0;
      let totals = [0,0,0];

      document.querySelectorAll("#itemsTable tbody tr").forEach(tr => {
        const qty = parseFloat(tr.cells[3].querySelector("input").value) || 0;
        for (let i=0; i<3; i++) {
          const price = parseFloat(tr.cells[4+i].querySelector("input").value) || 0;
          totals[i] += qty * price;
        }
      });

      totals = totals.map(t => t + (t * tax / 100));

      [1,2,3].forEach((num,i) => {
        const td = document.getElementById("total"+num);
        td.textContent = totals[i].toFixed(2);
        td.classList.remove("highlight");
      });

      const minVal = Math.min(...totals);
      totals.forEach((val,i) => {
        if (val === minVal) {
          document.getElementById("total"+(i+1)).classList.add("highlight");
        }
      });
    }

    function updateSupplierHeaders() {
      const s1 = document.getElementById("supplier1").value || "المورد الأول";
      const s2 = document.getElementById("supplier2").value || "المورد الثاني";
      const s3 = document.getElementById("supplier3").value || "المورد الثالث";

      document.getElementById("th-supplier1").textContent = "سعر " + s1;
      document.getElementById("th-supplier2").textContent = "سعر " + s2;
      document.getElementById("th-supplier3").textContent = "سعر " + s3;
    }

    function saveData() {
      const data = {
        date: document.getElementById("date").value,
        supplier1: document.getElementById("supplier1").value,
        supplier2: document.getElementById("supplier2").value,
        supplier3: document.getElementById("supplier3").value,
        committeeDate: document.getElementById("committeeDate").value,
        taxRate: document.getElementById("taxRate").value,
        table: [],
        footer: Array.from(document.querySelectorAll(".footer-inputs input")).map(inp => inp.value)
      };

      document.querySelectorAll("#itemsTable tbody tr").forEach(tr => {
        const row = [];
        tr.querySelectorAll("input").forEach(inp => row.push(inp.value));
        data.table.push(row);
      });

      const fileName = `${data.date}_${data.supplier1}.json`;
      const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = fileName;
      link.click();
    }

    function loadData() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = ".json";
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = ev => {
          const data = JSON.parse(ev.target.result);
          document.getElementById("date").value = data.date || "";
          document.getElementById("supplier1").value = data.supplier1 || "";
          document.getElementById("supplier2").value = data.supplier2 || "";
          document.getElementById("supplier3").value = data.supplier3 || "";
          document.getElementById("committeeDate").value = data.committeeDate || "";
          document.getElementById("taxRate").value = data.taxRate || 0;

          clearTable();
          data.table.forEach(row => {
            addRow();
            const tr = document.querySelector("#itemsTable tbody tr:last-child");
            const inputs = tr.querySelectorAll("input");
            row.forEach((val,i) => inputs[i].value = val);
          });

          const footerInputs = document.querySelectorAll(".footer-inputs input");
          data.footer.forEach((val,i) => { if(footerInputs[i]) footerInputs[i].value = val; });

          updateSupplierHeaders();
          updateTotals();
        };
        reader.readAsText(file);
      };
      input.click();
    }


    // دالة الانتقال وحفظ البيانات في localStorage
function goToTaw() {
  const data = {
    date: document.getElementById("date").value,
    supplier1: document.getElementById("supplier1").value,
    supplier2: document.getElementById("supplier2").value,
    supplier3: document.getElementById("supplier3").value,
    committeeDate: document.getElementById("committeeDate").value,
    taxRate: document.getElementById("taxRate").value,
    footer: Array.from(document.querySelectorAll(".footer-inputs input")).map(inp => inp.value)
  };

  // حفظ البيانات في localStorage
  localStorage.setItem('mainFormData', JSON.stringify(data));

  // الانتقال إلى صفحة taw.html
  window.location.href = 'taw.html';
}
  </script>
</body>
</html>
