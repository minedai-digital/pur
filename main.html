<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      background: #f0f2f5;
      color: #333;
    }
    header {
      background: #007bff;
      color: #fff;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
    }
    .container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .top-inputs {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    label {
      font-weight: 600;
      font-size: 14px;
      display: flex;
      flex-direction: column;
    }
    input {
      padding: 7px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #e5e5e5;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background: #f8f9fa;
    }
    tfoot td {
      font-weight: bold;
      background: #f1f3f5;
    }
    .highlight {
      background-color: #d4edda !important;
    }
    .controls, .footer-actions {
      margin-top: 20px;
      text-align: center;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      margin: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: 0.2s;
    }
    button:hover { opacity: 0.85; }
    .add { background: #007bff; color: #fff; }
    .clear { background: #dc3545; color: #fff; }
    .next { background: #28a745; color: #fff; }
    .save { background: #17a2b8; color: #fff; }
    .load { background: #6f42c1; color: #fff; }
    .footer-inputs {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
      gap: 15px;
    }

    /* âš¡ Ø¬Ø¹Ù„ Ø§Ù„ØµÙØ­Ø© Ù…ØªÙ†Ø§Ø³Ù‚Ø© Ù…Ø¹ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width: 768px) {
      header {
        font-size: 18px;
      }
      table th, table td {
        font-size: 12px;
        padding: 6px;
      }
      button {
        font-size: 12px;
        padding: 8px 12px;
      }
    }
  </style>
</head>





<!-- Ø¶Ø¹ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø£Ø³ÙÙ„ ÙˆØ³Ù… <body> Ù…Ø¨Ø§Ø´Ø±Ø© Ù‚Ø¨Ù„ <header> -->
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-logo"> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
    <ul class="nav-links">

      <li><a href="main.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a href="taw.html">Ø§Ù„ØªÙˆØ±ÙŠØ¯</a></li>
      <li><a href="taf.html">ØªÙØ±ÙŠØº</a></li>
      <li><a href="mahdr.html">Ù…Ø­Ø¶Ø±</a></li>
      <li><a href="talab.html">Ø·Ù„Ø¨</a></li>
      <li><a href="moka.html">Ù…Ù‚Ø§ÙŠØ³Ù‡</a></li>
      <li><a href="tash.html">ØªØ´ÙƒÙŠÙ„</a></li>
      <li><a href="custom.html">Ø§Ù„Ø¶Ø±Ø§ÙŠØ¨</a></li>
    </ul>
    <div class="nav-toggle" onclick="toggleMenu()">â˜°</div>
  </div>
</nav>

<style>
/* Navbar Ø£Ø³Ø§Ø³ÙŠ */
.navbar {
  background-color: #007bff;
  color: #fff;
  font-family: 'Cairo', sans-serif;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.nav-container {
  max-width: 1200px;
  margin: auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
}

.nav-logo {
  font-size: 20px;
  font-weight: bold;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 15px;
  margin: 0;
  padding: 0;
}

.nav-links li a {
  color: #fff;
  text-decoration: none;
  font-weight: 600;
  padding: 8px 12px;
  border-radius: 6px;
  transition: background 0.2s;
}

.nav-links li a:hover {
  background-color: rgba(255,255,255,0.2);
}

.nav-toggle {
  display: none;
  font-size: 24px;
  cursor: pointer;
}

/* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 768px) {
  .nav-links {
    display: none;
    flex-direction: column;
    gap: 10px;
    background-color: #007bff;
    padding: 10px 0;
  }
  .nav-links.active {
    display: flex;
  }
  .nav-toggle {
    display: block;
  }
}
</style>

<script>
function toggleMenu() {
  document.querySelector('.nav-links').classList.toggle('active');
}
</script>








<body>

  <header>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© </header>

  <div class="container">

    <!-- Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¹Ù„ÙˆÙŠØ© -->
    <div class="top-inputs">
      <label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: <input type="date" id="date"></label>
      <label>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„: <input list="suppliersList" id="supplier1" oninput="updateSupplierHeaders()"></label>
      <label>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ: <input list="suppliersList" id="supplier2" oninput="updateSupplierHeaders()"></label>
      <label>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«: <input list="suppliersList" id="supplier3" oninput="updateSupplierHeaders()"></label>
      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù„Ø¬Ù†Ø©: <input type="date" id="committeeDate"></label>
      <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %: <input type="number" id="taxRate" value="0" oninput="updateTotals()"></label>
    </div>

    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <table id="itemsTable">
      <thead>
        <tr>
          <th>Ù…</th>
          <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
          <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th id="th-supplier1">Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„</th>
          <th id="th-supplier2">Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ</th>
          <th id="th-supplier3">Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="4">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
          <td id="total1">0</td>
          <td id="total2">0</td>
          <td id="total3">0</td>
          <td colspan="2"></td>
        </tr>
      </tfoot>
    </table>

    <div class="controls">
      <button class="add" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
      <button class="clear" onclick="clearTable()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
<button class="next" onclick="goToTaw()">â¡ï¸ Ø§Ù†ØªÙ‚Ø§Ù„</button>  
  </div>

    <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© -->
    <div class="footer-inputs">
      <label><input list="staffList" placeholder="Ø§Ù„Ù…Ø®ØªØµ"></label>
      <label><input list="staffList" placeholder="Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…"></label>
      <label><input list="staffList" placeholder="ÙŠØ¹ØªÙ…Ø¯"></label>
      <label><input list="staffList" placeholder="Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠ"></label>
      <label><input list="staffList" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ø£ÙˆÙ„"></label>
      <label><input list="staffList" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠ"></label>
      <label><input list="staffList" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«"></label>
      <label><input list="staffList" placeholder="Ù…Ù‚Ø¯Ù…Ù‡ Ù„Ø³ÙŠØ§Ø¯ØªÙƒÙ…"></label>
      <label><input list="staffList" placeholder="Ø£Ù…Ø± Ø§Ù„Ø¯ÙØ¹ Ø¨Ø¥Ø³Ù…"></label>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ -->
    <div class="footer-actions">
      <button class="save" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <button class="load" onclick="loadData()">ğŸ“‚ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>

  </div>

  <!-- datalists -->
  <datalist id="suppliersList"></datalist>
  <datalist id="itemsList"></datalist>
  <datalist id="staffList"></datalist>

  <script src="data.js"></script>
  <script>
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
    Object.keys(suppliers).forEach(name => {
      let option = document.createElement("option");
      option.value = name;
      document.getElementById("suppliersList").appendChild(option);
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
    Object.keys(itemsDB).forEach(item => {
      let option = document.createElement("option");
      option.value = item;
      document.getElementById("itemsList").appendChild(option);
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
    staffDB.forEach(staff => {
      let option = document.createElement("option");
      option.value = staff;
      document.getElementById("staffList").appendChild(option);
    });

    let rowCount = 0;

    function addRow() {
      rowCount++;
      const tbody = document.querySelector("#itemsTable tbody");
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${rowCount}</td>
        <td><input list="itemsList" oninput="fillUnit(this)"></td>
        <td><input readonly></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input type="number" value="0" oninput="updateTotals()"></td>
        <td><input></td>
        <td><button onclick="removeRow(this)">Ù…Ø³Ø­</button></td>
      `;
      tbody.appendChild(tr);
    }

    function removeRow(btn) {
      btn.closest("tr").remove();
      updateTotals();
    }

    function clearTable() {
  // Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  document.querySelector("#itemsTable tbody").innerHTML = "";
  rowCount = 0;
  updateTotals();

  // Ù…Ø³Ø­ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
  document.getElementById("date").value = "";
  document.getElementById("supplier1").value = "";
  document.getElementById("supplier2").value = "";
  document.getElementById("supplier3").value = "";
  document.getElementById("committeeDate").value = "";
  document.getElementById("taxRate").value = "0";

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø³Ø­
  updateSupplierHeaders();

  // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø³ÙÙ„ÙŠØ©
  document.querySelectorAll(".footer-inputs input").forEach(inp => inp.value = "");
}


    function fillUnit(input) {
      const val = input.value;
      if (itemsDB[val]) {
        input.parentElement.nextElementSibling.querySelector("input").value = itemsDB[val].unit;
      }
    }

    function updateTotals() {
      const tax = parseFloat(document.getElementById("taxRate").value) || 0;
      let totals = [0,0,0];

      document.querySelectorAll("#itemsTable tbody tr").forEach(tr => {
        const qty = parseFloat(tr.cells[3].querySelector("input").value) || 0;
        for (let i=0; i<3; i++) {
          const price = parseFloat(tr.cells[4+i].querySelector("input").value) || 0;
          totals[i] += qty * price;
        }
      });

      totals = totals.map(t => t + (t * tax / 100));

      [1,2,3].forEach((num,i) => {
        const td = document.getElementById("total"+num);
        td.textContent = totals[i].toFixed(2);
        td.classList.remove("highlight");
      });

      const minVal = Math.min(...totals);
      totals.forEach((val,i) => {
        if (val === minVal) {
          document.getElementById("total"+(i+1)).classList.add("highlight");
        }
      });
    }

    function updateSupplierHeaders() {
      const s1 = document.getElementById("supplier1").value || "Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„";
      const s2 = document.getElementById("supplier2").value || "Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ";
      const s3 = document.getElementById("supplier3").value || "Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«";

      document.getElementById("th-supplier1").textContent = "Ø³Ø¹Ø± " + s1;
      document.getElementById("th-supplier2").textContent = "Ø³Ø¹Ø± " + s2;
      document.getElementById("th-supplier3").textContent = "Ø³Ø¹Ø± " + s3;
    }

    function saveData() {
      const data = {
        date: document.getElementById("date").value,
        supplier1: document.getElementById("supplier1").value,
        supplier2: document.getElementById("supplier2").value,
        supplier3: document.getElementById("supplier3").value,
        committeeDate: document.getElementById("committeeDate").value,
        taxRate: document.getElementById("taxRate").value,
        table: [],
        footer: Array.from(document.querySelectorAll(".footer-inputs input")).map(inp => inp.value)
      };

      document.querySelectorAll("#itemsTable tbody tr").forEach(tr => {
        const row = [];
        tr.querySelectorAll("input").forEach(inp => row.push(inp.value));
        data.table.push(row);
      });

      const fileName = `${data.date}_${data.supplier1}.json`;
      const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = fileName;
      link.click();
    }

    function loadData() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = ".json";
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = ev => {
          const data = JSON.parse(ev.target.result);
          document.getElementById("date").value = data.date || "";
          document.getElementById("supplier1").value = data.supplier1 || "";
          document.getElementById("supplier2").value = data.supplier2 || "";
          document.getElementById("supplier3").value = data.supplier3 || "";
          document.getElementById("committeeDate").value = data.committeeDate || "";
          document.getElementById("taxRate").value = data.taxRate || 0;

          clearTable();
          data.table.forEach(row => {
            addRow();
            const tr = document.querySelector("#itemsTable tbody tr:last-child");
            const inputs = tr.querySelectorAll("input");
            row.forEach((val,i) => inputs[i].value = val);
          });

          const footerInputs = document.querySelectorAll(".footer-inputs input");
          data.footer.forEach((val,i) => { if(footerInputs[i]) footerInputs[i].value = val; });

          updateSupplierHeaders();
          updateTotals();
        };
        reader.readAsText(file);
      };
      input.click();
    }


    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
function goToTaw() {
  const data = {
    date: document.getElementById("date").value,
    supplier1: document.getElementById("supplier1").value,
    supplier2: document.getElementById("supplier2").value,
    supplier3: document.getElementById("supplier3").value,
    committeeDate: document.getElementById("committeeDate").value,
    taxRate: document.getElementById("taxRate").value,
    footer: Array.from(document.querySelectorAll(".footer-inputs input")).map(inp => inp.value)
  };

  // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
  localStorage.setItem('mainFormData', JSON.stringify(data));

  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© taw.html
  window.location.href = 'taw.html';
}
  </script>
</body>
</html>
