<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª - Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
  <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª - Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Lateef&family=Cairo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {font-family:'Cairo','Lateef',Arial,sans-serif; background:#f8fafb;}
    nav.navbar {background:#156ab2; color:#fff;padding:7px 0 0 0;border-radius:0 0 18px 18px;box-shadow:0 6px 24px #94d9fd26;}
    .nav-container{display:flex;align-items:center;justify-content:space-between;max-width:1200px;margin:auto;}
    .nav-logo{font-size:1.21rem;padding:8px 24px;letter-spacing:1px;font-family:'Amiri',serif}
    .nav-links{display:flex;gap:7px;margin:0;padding:0;list-style:none}
    .nav-links li{display:inline-block;}
    .nav-links a{color:#fff;text-decoration:none;font-size:1rem;padding:9px 16px;border-radius:7px;transition:.13s;}
    .nav-links a:hover,.nav-links a.active{background:#3482ce;color:#fffd9b;}
    .nav-login{padding:0 20px;}
    .btn-login{background:#fcfbc3;padding:9px 18px;border:0;border-radius:7px;font-size:1rem;color:#3269b7;cursor:pointer;}
    .btn-login:hover{background:#fff19e}
    .nav-toggle{display:none;}
    @media(max-width:1100px){.nav-container{flex-wrap:wrap;}.nav-links{flex-wrap:wrap;}}
    @media(max-width:830px){.nav-links a{padding:9px 8px; font-size:0.95rem;}}
    @media(max-width:600px){
      .nav-links{flex-direction:column;align-items:flex-start;}
      .nav-links a{padding:9px 5px;}
      .nav-container{flex-direction:column;align-items:flex-start;}
      .nav-toggle{display:block;position:absolute;top:11px;left:15px;}
    }

    header.main-header {background: linear-gradient(135deg, #2196f3 0%, #1865be 100%); color: white; padding: 2rem 1rem; text-align: center; box-shadow: 0 7px 24px #6ddcff40; margin-bottom: 2rem; border-radius: 0 0 25px 25px;}
    header.main-header h1{font-family:'Amiri',serif;font-size:2.2rem;letter-spacing:1px;}
    .main-header .entity-bar{font-family:'Lateef','Cairo';font-size:1.13rem;background:#e3f7f9;color:#215e87;margin:14px auto 0;padding:7px 12px;display:inline-block;border-radius:6px;}
    
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:1.1rem;margin-bottom:2rem;}
    .stat-card{background:white;padding:1.3rem 0.7rem;border-radius:15px;box-shadow:0 3px 12px #b0dee233;text-align:center;min-width:180px;}
    .stat-card h3{color:#2380bf;font-size:1.02rem;}
    .stat-card .stat-value{font-size:1.49rem;font-weight:bold;color:#166c81;}

    .stats-summary{display:flex;justify-content:center;gap:2.7rem;align-items:center;margin-bottom:1.4rem;}
    .stats-summary div{font-size:1.1rem;}
    
    .entity-config-section{margin-bottom:2.2rem;}
    .entity-config-title{font-family:'Amiri',serif;font-size:1.18rem;color:#2363b5;}
    .entity-inputs{display:flex;gap:1.1rem;flex-wrap:wrap;}
    .entity-inputs .enhanced-input{flex:1;}
    
    .form-section,.signatures-section,.controls-section{background:white;padding:2rem;border-radius:17px;box-shadow:0 3px 14px #b0e6ef33;margin-bottom:2rem;}
    h2.section-title{font-family:'Amiri',serif;font-size:1.22rem;color:#1769ae;margin-bottom:1.4rem;}
    .input-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.4rem;margin-bottom:2rem;}
    .enhanced-input{position:relative;}
    .enhanced-input input {width: 100%; padding: 0.75rem 1rem; border: 2px solid #1765ae; border-radius: 11px; font-size: 1rem; color:#0e375c;}
    .enhanced-input input:focus { border-color: #2196f3; box-shadow: 0 0 0 0.14rem #aae6e911;}
    .enhanced-input label{color:#165b62;font-weight:700;}
    .table-container{background:white;border-radius:16px;overflow:hidden;box-shadow:0 3px 14px #b1e4ea2a;margin-bottom:1.6rem;}
    .table-header{background:#2196f3;color:white;padding:1rem 1.5rem;font-weight:600;font-size:1.04rem;}
    .enhanced-table{width:100%;border-collapse:collapse;font-size:1.02rem;}
    .enhanced-table th{background:#2066be;color:#fff;padding:0.95rem 0.5rem;font-weight:600;text-align:center;}
    .enhanced-table td{padding:0.73rem;border:1px solid #bedff1;text-align:center;color:#174053;font-size:1.01rem;}
    .enhanced-table input[type="text"], .enhanced-table input[type="number"]{color:#174053!important;font-weight:600;background:#f5fdff;border-radius:8px;padding:5px 7px;font-size:1rem;}
    .enhanced-table tfoot td{background:#ecf7fe;font-weight:bold;}
    .action-buttons{display:flex;gap:0.5rem;justify-content:center;flex-wrap:wrap;}
    .btn{background:linear-gradient(90deg,#1ebea5 0%,#156ab2 100%);color:#fff;border:none;border-radius:10px;padding:0.5rem 1.2rem;font-size:1rem;margin-top:0.2rem;cursor:pointer;transition:.15s;}
    .btn:hover{background:linear-gradient(90deg,#2196f3 10%,#43d5a0 85%);}
    .signatures-section{margin-top:1.7rem;}
    .signatures-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:1.3rem;}
    .signature-card{background:#f5f9fc;padding:1.1rem;border-radius:12px;border:1px solid #d2eaf1;}
    .highlight-cell{background: #9afdcd!important;color:#084e27!important;}
    footer {margin:35px 0 15px; font-family:'Lateef','Cairo'; text-align:right; font-size:1.08rem; color:#144054;}
    .entity-footer {margin-top:18px;}
    @media (max-width:1150px){.entity-inputs{flex-direction:column;gap:0.7rem;}}
    @media (max-width:800px){header.main-header{padding:1.15rem;}
      .stats-grid,.input-grid,.signatures-grid{grid-template-columns:1fr;}
      .table-header{padding:0.7rem;}
      .entity-bar{font-size:0.99rem;}
    }
    @media print {
      body {background:white;}
      header.main-header,.navbar,.controls-section,.action-buttons,.btn,.entity-footer{display:none!important;}
      .table-header{background:#2196f3!important;}
      .form-section,.table-container,.signatures-section{box-shadow:none;border-radius:0;}
      .print-header,.print-stamp{display:block!important;}
      .signatures-section{margin:0;}
      .enhanced-table{font-size:1.04rem!important;}
    }
    /* ØªØ¹Ø·ÙŠÙ„ Ø£Ø³Ù‡Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
    input[type="number"],input[pattern="\d*"]{-webkit-appearance:none;-moz-appearance:textfield;appearance:textfield;}
    input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0;}
  </style>
</head>
<body>
  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù„Ù„Ù‚ÙˆØ§Ø¦Ù… -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo"><span>ğŸ¥</span> Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
      <ul class="nav-links">
        <li><a href="main.html" class="active">ğŸ“‹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</a></li>
        <li><a href="taw.html">ğŸ“¦ Ø£Ù…Ø± Ø§Ù„ØªÙˆØ±ÙŠØ¯</a></li>
        <li><a href="taf.html">ğŸ’° ØªÙØ±ÙŠØº Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</a></li>
        <li><a href="mahdr.html">ğŸ“ Ø§Ù„Ù…Ø­Ø¶Ø±</a></li>
        <li><a href="talab.html">ğŸ“„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡</a></li>
        <li><a href="moka.html">ğŸ“ˆ Ø§Ù„Ù…Ù‚Ø§ÙŠØ³Ø©</a></li>
        <li><a href="tash.html">ğŸ‘¥ ØªØ´ÙƒÙŠÙ„ Ù„Ø¬Ù†Ø©</a></li>
        <li><a href="custom.html">ğŸ“Š Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨</a></li>
      </ul>
      <div class="nav-login">
        <button class="btn-login" onclick="if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) window.location.href='index.html'" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">
          <span>ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </button>
      </div>
      <div class="nav-toggle" onclick="toggleMenu()"><span>â˜°</span></div>
    </div>
  </nav>

  <header class="main-header">
    <h1 id="entityNameHeader">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª</h1>
    <div class="entity-bar" id="entityDeptHeader"></div>
    <p>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</p>
    <div class="progress-indicator"><div class="progress-bar"></div></div>
  </header>

  <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª/Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø­ÙŠØ© Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª -->
  <div class="stats-summary" dir="rtl">
    <div style="color:#115b99;border-bottom:2.5px solid #2196f3;padding-bottom:2.5px;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¯Ø®Ù„Ø©: <span id="countItems" style="font-weight:bold;">0</span></div>
    <div style="color:#0e8037;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„: <span id="supplierTotal1" style="font-weight:bold;">0.00</span> Ø¬.Ù…</div>
    <div style="color:#8d710c;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ: <span id="supplierTotal2" style="font-weight:bold;">0.00</span> Ø¬.Ù…</div>
    <div style="color:#c02f34;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«: <span id="supplierTotal3" style="font-weight:bold;">0.00</span> Ø¬.Ù…</div>
  </div>

  <div class="container main-form">
    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="stats-grid">
      <div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3><div class="stat-value">0</div></div>
      <div class="stat-card"><h3>Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3><div class="stat-value">0</div></div>
      <div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©</h3><div class="stat-value">0.00 Ø¬.Ù…</div></div>
    </div>

    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù‡Ø© -->
    <div class="entity-config-section">
      <h3 class="entity-config-title"><span>ğŸ¥</span> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù‡Ø©</h3>
      <div class="entity-inputs">
        <div class="enhanced-input">
          <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©:</label>
          <input type="text" id="entityName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©">
        </div>
        <div class="enhanced-input">
          <label class="form-label">Ø§Ù„Ù‚Ø³Ù…:</label>
          <input type="text" id="entityDepartment" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…">
        </div>
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙƒÙ…Ø§ Ù‡Ùˆ -->
    <div class="form-section">
      <h2 class="section-title">ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
      <div class="input-grid">
        <div class="enhanced-input">
          <label class="form-label">ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
          <input type="date" id="date" class="form-control" required>
        </div>
        <div class="enhanced-input">
          <label class="form-label">Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„:</label>
          <input list="suppliersList" id="supplier1" class="form-control" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„" oninput="mainFormManager?.updateSupplierHeaders()">
        </div>
        <div class="enhanced-input">
          <label class="form-label">Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
          <input list="suppliersList" id="supplier2" class="form-control" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ" oninput="mainFormManager?.updateSupplierHeaders()">
        </div>
        <div class="enhanced-input">
          <label class="form-label">Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«:</label>
          <input list="suppliersList" id="supplier3" class="form-control" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«" oninput="mainFormManager?.updateSupplierHeaders()">
        </div>
        <div class="enhanced-input">
          <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù„Ø¬Ù†Ø©:</label>
          <input type="date" id="committeeDate" class="form-control" required>
        </div>
        <div class="enhanced-input">
          <label class="form-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %:</label>
          <input type="number" id="taxRate" class="form-control" value="14" min="0" max="100" step="0.01">
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„ØªØ¬Ù…ÙŠØ¹ ÙˆØ§Ù„ØªÙ…ÙŠÙŠØ² -->
    <div class="table-container">
      <div class="table-header">
        <span>ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</span>
        <div class="action-buttons" style="float:left;">
          <button class="btn" onclick="addRow()" title="Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯"><span>â•</span> Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
          <button class="btn" onclick="clearTable()" title="Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"><span>ğŸ—‘ï¸</span> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
        </div>
        <div style="clear:both;"></div>
      </div>
      <table class="enhanced-table" id="itemsTable">
        <thead>
          <tr>
            <th>Ù…</th>
            <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th id="th-supplier1">Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„</th>
            <th id="th-supplier2">Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ</th>
            <th id="th-supplier3">Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«</th>
            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        
          <tbody id="itemsTableBody"></tbody>

        
        <tfoot>
          <tr>
            <td colspan="4"><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</b></td>
            <td id="total1" class="highlight-cell">0.00</td>
            <td id="total2" class="highlight-cell">0.00</td>
            <td id="total3" class="highlight-cell">0.00</td>
            <td colspan="2"></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="signatures-section">
      <h3 class="section-title">âœï¸ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª</h3>
      <div id="signaturesList" class="signatures-grid"></div>
    </div>

    <div class="controls-section">
      <h3 class="section-title">ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ…</h3>
      <div class="action-buttons">
        <button class="btn" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
        <button class="btn" onclick="mainFormManager?.saveData?.()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="btn" onclick="mainFormManager?.loadData?.()">ğŸ“ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="btn" onclick="saveAndGo()" title="Ø­ÙØ¸ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„"><span>ğŸ’¾</span> Ø­ÙØ¸ ÙˆØ§Ù†ØªÙ‚Ø§Ù„</button>
        <button class="btn" onclick="clearTable()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
        <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
    </div>
    <footer class="entity-footer" id="signaturesFooter"></footer>
  </div>

  <datalist id="suppliersList"></datalist>
  <datalist id="itemsList"></datalist>
  <datalist id="staffList"></datalist>

  <script src="js/data.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/main.js"></script>
  <script>
    // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø© ÙˆØ§Ù„Ù‚Ø³Ù… Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© 
    document.addEventListener('DOMContentLoaded',function(){
      let entityName = localStorage.getItem('hospitalName') || '';
      let entityDept = localStorage.getItem('departmentName') || '';
      document.getElementById('entityNameHeader').innerText = entityName || 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª';
      document.getElementById('entityDeptHeader').innerText = entityDept || '';
      document.getElementById('entityName').value = entityName;
      document.getElementById('entityDepartment').value = entityDept;
      // Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª
      let sigs = [];
      try { sigs = JSON.parse(localStorage.getItem('signaturesArray')) || []; } catch{}
      if (sigs.length) {
        let html = sigs.map(sig => `<div class="signature-card">${sig.name}<br><small style="color:#29709f">${sig.desc}</small></div>`).join("");
        document.getElementById('signaturesList').innerHTML = html;
        document.getElementById('signaturesFooter').innerHTML = 
          sigs.map(sig => `<b>${sig.name}</b> Ù€ <span style="color:#2579a2">${sig.desc}</span>`).join("ØŒ ");
      }
      updateTotalsLive();
    });
    document.getElementById('entityName').addEventListener('input',function(e){
      localStorage.setItem('hospitalName',e.target.value);
      document.getElementById('entityNameHeader').innerText = e.target.value;
    });
    document.getElementById('entityDepartment').addEventListener('input',function(e){
      localStorage.setItem('departmentName',e.target.value);
      document.getElementById('entityDeptHeader').innerText = e.target.value;
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØªÙ…ÙŠÙŠØ² Ø§Ù„Ø£Ù‚Ù„
    function updateTotalsLive() {
      const tbody = document.querySelector('#itemsTable tbody');
      let total = [0,0,0];
      let count = 0;
      [...tbody.rows].forEach(tr => {
        let qty = parseFloat(tr.cells[3].querySelector('input').value) || 0;
        if (qty>0) count++;
        for(let i=0;i<3;i++){
          let price = parseFloat(tr.cells[4+i].querySelector('input').value) || 0;
          total[i] += qty*price;
        }
      });
      document.getElementById('countItems').textContent = count;
      document.getElementById('supplierTotal1').textContent = total[0].toFixed(2);
      document.getElementById('supplierTotal2').textContent = total[1].toFixed(2);
      document.getElementById('supplierTotal3').textContent = total[2].toFixed(2);

      // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£Ù‚Ù„ ÙÙŠ tfoot & Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
      let minVal = Math.min(...total.filter(x=>x>0));
      for(let i=0;i<3;i++){
        let td = document.getElementById('total'+(i+1));
        let st = document.getElementById('supplierTotal'+(i+1));
        td.classList.remove('highlight-cell');
        st.parentNode.classList.remove('highlight-cell');
        if(minVal === total[i] && minVal>0){
          td.classList.add('highlight-cell');
          st.parentNode.classList.add('highlight-cell');
        }
      }
    }
    // Ø­Ø¯Ø« Ø§Ù„Ù‚ÙŠÙ… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø£ÙŠ Ù…Ø¯Ø®Ù„ Ø±Ù‚Ù…ÙŠ Ø¨Ù€table ÙÙ‚Ø·
    document.addEventListener('input', function(e){
      if(
        e.target.matches('.enhanced-table input[type="text"], .enhanced-table input[type="number"]')
        || e.target.closest('.enhanced-table')
      ){
        updateTotalsLive();
      }
    });
    setTimeout(updateTotalsLive, 200); // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    // Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
    function toggleMenu(){document.querySelector('.nav-links').classList.toggle('active');}


function createRow(num, item='', unit='', qty=1, price1=0, price2=0, price3=0, notes=''){
  return `<tr>
    <td>${num}</td>
    <td><input list="itemsList" value="${item}" placeholder="Ø§Ø®ØªØ± ØµÙ†Ù"></td>
<td><input value="${unit}" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø©"></td>
    <td><input type="number" value="${qty}" min="0" step="any" style="width:80px;"></td>
    <td><input type="number" value="${price1}" min="0" step="any" style="width:85px;"></td>
    <td><input type="number" value="${price2}" min="0" step="any" style="width:85px;"></td>
    <td><input type="number" value="${price3}" min="0" step="any" style="width:85px;"></td>
    <td><input value="${notes}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></td>
    <td><button onclick="this.closest('tr').remove(); updateTotalsLive();" class="btn">Ù…Ø³Ø­</button></td>
  </tr>`;
}

// Ù…Ø«Ø§Ù„ Ø¥Ø¶Ø§ÙØ© 3 ØµÙÙˆÙ Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.addEventListener('DOMContentLoaded',()=>{
  let tbody = document.getElementById('itemsTableBody');
  tbody.innerHTML = '';
  for(let i=0;i<3;i++){ tbody.innerHTML += createRow(i+1); }
  updateTotalsLive();
});

// Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø§Ù„Ø­Ø°Ù Ø£Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
document.addEventListener('input', function(e){
  if( e.target.closest('#itemsTable') ){
    updateTotalsLive();
  }
});
function addRow(){
  let tbody = document.getElementById('itemsTableBody');
  let n = tbody.rows.length+1;
  tbody.innerHTML += createRow(n);
  updateTotalsLive();
}

function updateTotalsLive(){
  let tbody = document.getElementById('itemsTableBody');
  let total=[0,0,0], count=0;
  [...tbody.rows].forEach((tr,idx)=>{
    tr.cells[0].textContent = idx+1;
    let qty = parseFloat(tr.cells[3].querySelector('input').value) || 0;
    if(qty>0) count++;
    for(let i=0;i<3;i++){
      let price = parseFloat(tr.cells[4+i].querySelector('input').value) || 0;
      total[i] += qty*price;
    }
  });
  document.getElementById('countItems').textContent=count;
  document.getElementById('supplierTotal1').textContent=total[0].toFixed(2);
  document.getElementById('supplierTotal2').textContent=total[1].toFixed(2);
  document.getElementById('supplierTotal3').textContent=total[2].toFixed(2);

  // Ù„ÙˆÙ† Ø§Ù„Ø£Ù‚Ù„
  let minVal = Math.min(...total.filter(x=>x>0));
  for(let i=0;i<3;i++){
    let td = document.getElementById('total'+(i+1));
    let st = document.getElementById('supplierTotal'+(i+1));
    td.classList.remove('highlight-cell'); st.parentNode.classList.remove('highlight-cell');
    if(minVal === total[i] && minVal>0){
      td.classList.add('highlight-cell'); st.parentNode.classList.add('highlight-cell');
    }
    td.textContent = total[i].toFixed(2);
  }
}


function saveAndGo() {
  // Ø¬Ù…Ø¹ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙØ­Ø©
  const data = {
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù‡Ø©
    entityName: document.getElementById('entityName').value,
    entityDepartment: document.getElementById('entityDepartment').value,
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
    date: document.getElementById('date').value,
    supplier1: document.getElementById('supplier1').value,
    supplier2: document.getElementById('supplier2').value,
    supplier3: document.getElementById('supplier3').value,
    committeeDate: document.getElementById('committeeDate').value,
    taxRate: document.getElementById('taxRate').value,
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    table: Array.from(document.querySelectorAll('#itemsTable tbody tr')).map(tr => ({
      name: tr.cells[1].querySelector('input').value,
      unit: tr.cells[2].querySelector('input').value,
      qty: tr.cells[3].querySelector('input').value,
      price1: tr.cells[4].querySelector('input').value,
      price2: tr.cells[5].querySelector('input').value,
      price3: tr.cells[6].querySelector('input').value,
      notes: tr.cells[7].querySelector('input').value
    })),
    // Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª/Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ
    signatures: Array.from(document.querySelectorAll('.signatures-section .signature-card')).map(div => div.textContent.trim())
  };
  // Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ LocalStorage Ø¨Ø§Ø³Ù… Ø«Ø§Ø¨Øª
  localStorage.setItem("mainFormData", JSON.stringify(data));
  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø«Ù„Ø§ Ù„ØµÙØ­Ø© taw.html Ø£Ùˆ ØºÙŠØ±Ù‡Ø§ (Ø¹Ø¯Ù‘Ù„ Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©)
  window.location.href = "taw.html";
}









  </script>
</body>
</html>
