<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙØ±ÙŠØº Ø§Ù„Ø£Ø³Ø¹Ø§Ø± - taf</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { 
    font-family: 'Cairo', sans-serif; 
    margin: 0; 
    background: #f0f2f5; 
    color: #333; 
    line-height: 1.6;
  }
  
  /* Navbar Styles */
  .navbar {
    background-color: #007bff;
    color: #fff;
    font-family: 'Cairo', sans-serif;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }

  .nav-container {
    max-width: 1200px;
    margin: auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
  }

  .nav-logo {
    font-size: 20px;
    font-weight: bold;
  }

  .nav-links {
    list-style: none;
    display: flex;
    gap: 15px;
    margin: 0;
    padding: 0;
  }

  .nav-links li a {
    color: #fff;
    text-decoration: none;
    font-weight: 600;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background 0.2s;
  }

  .nav-links li a:hover {
    background-color: rgba(255,255,255,0.2);
  }

  .nav-toggle {
    display: none;
    font-size: 24px;
    cursor: pointer;
  }

  header { 
    background: #007bff; 
    color: #fff; 
    padding: 15px; 
    text-align: center; 
    font-size: 22px; 
    font-weight: bold; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.15); 
  }
  
  .container { 
    max-width: 1400px; 
    margin: 20px auto; 
    background: #fff; 
    padding: 20px; 
    border-radius: 8px; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
  }
  
  h1.title { 
    text-align: center; 
    font-size: 28px; 
    margin-bottom: 20px; 
    font-weight: bold; 
    color: #007bff;
  }
  
  table { 
    width: 100%; 
    border-collapse: collapse; 
    margin-top: 20px; 
    background: #fff; 
    border-radius: 8px; 
    overflow: hidden; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.1); 
  }
  
  th, td { 
    border: 1px solid #e5e5e5; 
    padding: 8px; 
    text-align: center; 
    font-size: 14px; 
    vertical-align: middle;
  }
  
  th { 
    background: #f8f9fa; 
    font-weight: 600; 
    color: #495057;
  }
  
  tfoot td { 
    font-weight: bold; 
    background: #f1f3f5; 
    color: #007bff;
  }
  
  .highlight { 
    background-color: #d4edda !important; 
    border: 2px solid #28a745 !important;
    font-weight: bold;
  }
  
  .footer-inputs, .top-inputs { 
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
    gap: 15px; 
    margin-top: 20px; 
  }
  
  .footer-inputs label, .top-inputs label { 
    display: flex; 
    flex-direction: column; 
    font-weight: 600; 
  }
  
  input { 
    padding: 8px; 
    border: 1px solid #ccc; 
    border-radius: 6px; 
    margin-top: 5px; 
    font-family: 'Cairo', sans-serif;
    transition: border-color 0.2s;
  }
  
  input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0,123,255,0.25);
  }
  
  button { 
    padding: 10px 18px; 
    border: none; 
    border-radius: 6px; 
    margin: 5px; 
    cursor: pointer; 
    font-size: 14px; 
    font-weight: bold; 
    transition: all 0.2s;
    font-family: 'Cairo', sans-serif;
  }
  
  button:hover { 
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
  
  .print { 
    background: #28a745; 
    color: #fff; 
  }
  
  .print:hover {
    background: #218838;
  }
  
  .add { 
    background: #007bff; 
    color: #fff; 
  }
  
  .add:hover {
    background: #0056b3;
  }
  
  .clear { 
    background: #dc3545; 
    color: #fff; 
  }
  
  .clear:hover {
    background: #c82333;
  }
  
  .remove-btn {
    background: #fd7e14;
    color: #fff;
    padding: 5px 10px;
    font-size: 12px;
    border-radius: 4px;
  }
  
  .remove-btn:hover {
    background: #e8590c;
  }
  
  .controls-section {
    text-align: center; 
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
  }
  
  .supplier-headers {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin: 20px 0;
  }
  
  .supplier-input {
    display: flex;
    flex-direction: column;
  }
  
  .supplier-input label {
    font-weight: 600;
    margin-bottom: 5px;
    color: #495057;
  }
  
  .table-wrapper {
    overflow-x: auto;
    margin-top: 20px;
  }
  
  .loading {
    opacity: 0.6;
    pointer-events: none;
  }
  
  .error-message {
    color: #dc3545;
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    padding: 10px;
    border-radius: 6px;
    margin: 10px 0;
    text-align: center;
  }
  
  .success-message {
    color: #155724;
    background: #d4edda;
    border: 1px solid #c3e6cb;
    padding: 10px;
    border-radius: 6px;
    margin: 10px 0;
    text-align: center;
  }

  /* Print Styles */
  @media print {
    .navbar, .controls-section, .supplier-headers, button {
      display: none !important;
    }
    
    body {
      background: white;
    }
    
    .container {
      box-shadow: none;
      padding: 10px;
      margin: 0;
    }
    
    table {
      box-shadow: none;
    }
    
    th, td {
      font-size: 12px;
      padding: 6px;
    }
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    table, th, td { 
      font-size: 12px; 
    }
    
    .container {
      margin: 10px;
      padding: 15px;
    }
  }
  
  @media (max-width: 768px) {
    .nav-links {
      display: none;
      flex-direction: column;
      gap: 10px;
      background-color: #007bff;
      padding: 10px 0;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
    }
    
    .nav-links.active {
      display: flex;
    }
    
    .nav-toggle {
      display: block;
    }
    
    .footer-inputs, .top-inputs, .supplier-headers { 
      grid-template-columns: 1fr; 
    }
    
    .table-wrapper {
      overflow-x: scroll;
    }
    
    table {
      min-width: 800px;
    }
    
    .controls-section {
      padding: 10px;
    }
    
    button {
      margin: 3px;
      padding: 8px 12px;
      font-size: 12px;
    }
  }
</style>
</head>

<body>
<!-- Navigation Bar -->
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-logo">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
    <ul class="nav-links">
      <li><a href="main.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a href="taw.html">Ø§Ù„ØªÙˆØ±ÙŠØ¯</a></li>
      <li><a href="taf.html" style="background-color: rgba(255,255,255,0.2);">ØªÙØ±ÙŠØº</a></li>
      <li><a href="mahdr.html">Ù…Ø­Ø¶Ø±</a></li>
      <li><a href="talab.html">Ø·Ù„Ø¨</a></li>
      <li><a href="moka.html">Ù…Ù‚Ø§ÙŠØ³Ù‡</a></li>
      <li><a href="tash.html">ØªØ´ÙƒÙŠÙ„</a></li>
      <li><a href="custom.html">Ø§Ù„Ø¶Ø±Ø§ÙŠØ¨</a></li>
    </ul>
    <div class="nav-toggle" onclick="toggleMenu()">â˜°</div>
  </div>
</nav>

<header>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµØ­ÙŠØ©</header>

<div class="container">
  <h1 class="title">ØªÙØ±ÙŠØº Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h1>

  <!-- Date Input -->
  <div class="top-inputs">
    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ±ÙŠØº: <input type="date" id="orderDate"></label>
  </div>

  <!-- Supplier Names Section -->
  <div class="supplier-headers">
    <div class="supplier-input">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„:</label>
      <input type="text" id="supplier1Name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„" oninput="updateSupplierHeader(1)">
    </div>
    <div class="supplier-input">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
      <input type="text" id="supplier2Name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ" oninput="updateSupplierHeader(2)">
    </div>
    <div class="supplier-input">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«:</label>
      <input type="text" id="supplier3Name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«" oninput="updateSupplierHeader(3)">
    </div>
  </div>

  <!-- Controls -->
  <div class="controls-section">
    <button class="add" onclick="addEmptyRow()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
    <button class="clear" onclick="confirmClearTable()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
    <button class="print" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="add" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  </div>

  <!-- Table -->
  <div class="table-wrapper">
    <table id="itemsTable">
      <thead>
        <tr>
          <th>Ù…</th>
          <th>Ø§Ù„ØµÙ†Ù</th>
          <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th id="th-supplier1">Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø£ÙˆÙ„</th>
          <th>Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
          <th id="th-supplier2">Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ</th>
          <th>Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
          <th id="th-supplier3">Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø«Ø§Ù„Ø«</th>
          <th>Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>
          <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="4">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
          <td id="total1">0.00</td>
          <td id="total1After">0.00</td>
          <td id="total2">0.00</td>
          <td id="total2After">0.00</td>
          <td id="total3">0.00</td>
          <td id="total3After">0.00</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Footer Inputs -->
  <div class="footer-inputs">
    <label>Ø§Ù„Ù…Ø®ØªØµ: <input type="text" id="officer" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØµ"></label>
    <label>Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…: <input type="text" id="head" placeholder="Ø§Ø³Ù… Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…"></label>
    <label>ÙŠØ¹ØªÙ…Ø¯: <input type="text" id="approved" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯"></label>
    <label>Ø¹Ø¶Ùˆ Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ø£ÙˆÙ„: <input type="text" id="committee1" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø£ÙˆÙ„"></label>
    <label>Ø¹Ø¶Ùˆ Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠ: <input type="text" id="committee2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø«Ø§Ù†ÙŠ"></label>
    <label>Ø¹Ø¶Ùˆ Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«: <input type="text" id="committee3" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø«Ø§Ù„Ø«"></label>
  </div>
</div>

<script>
let rowCount = 0;
const TAX_RATE = 0.15; // Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 15%

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
  loadSavedData();
  setCurrentDate();
});

// ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
function setCurrentDate() {
  if (!document.getElementById('orderDate').value) {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('orderDate').value = today;
  }
}

// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ù‡Ø§ØªÙ
function toggleMenu() {
  document.querySelector('.nav-links').classList.toggle('active');
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
function updateSupplierHeader(supplierNum) {
  const supplierName = document.getElementById(`supplier${supplierNum}Name`).value || `Ø§Ù„Ù…ÙˆØ±Ø¯ ${supplierNum === 1 ? 'Ø§Ù„Ø£ÙˆÙ„' : supplierNum === 2 ? 'Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„Ø«Ø§Ù„Ø«'}`;
  document.getElementById(`th-supplier${supplierNum}`).textContent = supplierName;
}

// Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯ ÙØ§Ø±Øº
function addEmptyRow() {
  rowCount++;
  const tbody = document.querySelector('#itemsTable tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${rowCount}</td>
    <td><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td><input type="text" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø©" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td><input type="number" value="1" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td><input type="number" value="0" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td class="calculated-cell">0.00</td>
    <td><input type="number" value="0" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td class="calculated-cell">0.00</td>
    <td><input type="number" value="0" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td class="calculated-cell">0.00</td>
    <td><button class="remove-btn" onclick="removeRow(this)">Ù…Ø³Ø­</button></td>
  `;
  tbody.appendChild(tr);
  updateTotals();
  
  // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø­Ù‚Ù„ ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯
  tr.querySelector('input').focus();
}

// Ø¥Ø²Ø§Ù„Ø© ØµÙ Ù…Ø¹ ØªØ£ÙƒÙŠØ¯
function removeRow(btn) {
  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ')) {
    btn.closest('tr').remove();
    updateRowNumbers();
    updateTotals();
    showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
  }
}

// ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙÙˆÙ
function updateRowNumbers() {
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  rows.forEach((row, index) => {
    row.cells[0].textContent = index + 1;
  });
  rowCount = rows.length;
}

// Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ ØªØ£ÙƒÙŠØ¯
function confirmClearTable() {
  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
    clearTable();
  }
}

// Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
function clearTable() {
  document.querySelector('#itemsTable tbody').innerHTML = '';
  rowCount = 0;
  updateTotals();
  showMessage('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ…
function updateRow(input) {
  try {
    const tr = input.closest('tr');
    const qty = parseFloat(tr.cells[3].querySelector('input').value) || 0;
    const price1 = parseFloat(tr.cells[4].querySelector('input').value) || 0;
    const price2 = parseFloat(tr.cells[6].querySelector('input').value) || 0;
    const price3 = parseFloat(tr.cells[8].querySelector('input').value) || 0;

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
    const total1 = qty * price1;
    const total2 = qty * price2;
    const total3 = qty * price3;
    
    const after1 = total1 * (1 + TAX_RATE);
    const after2 = total2 * (1 + TAX_RATE);
    const after3 = total3 * (1 + TAX_RATE);

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„Ø§ÙŠØ§
    tr.cells[5].textContent = after1.toFixed(2);
    tr.cells[7].textContent = after2.toFixed(2);
    tr.cells[9].textContent = after3.toFixed(2);

    updateTotals();
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ:', error);
    showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª', 'error');
  }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
function updateTotals() {
  try {
    let totals = [0, 0, 0, 0, 0, 0]; // total1, after1, total2, after2, total3, after3

    document.querySelectorAll('#itemsTable tbody tr').forEach(tr => {
      const qty = parseFloat(tr.cells[3].querySelector('input').value) || 0;
      const price1 = parseFloat(tr.cells[4].querySelector('input').value) || 0;
      const price2 = parseFloat(tr.cells[6].querySelector('input').value) || 0;
      const price3 = parseFloat(tr.cells[8].querySelector('input').value) || 0;
      
      const total1 = qty * price1;
      const total2 = qty * price2;
      const total3 = qty * price3;
      
      totals[0] += total1;
      totals[1] += total1 * (1 + TAX_RATE);
      totals[2] += total2;
      totals[3] += total2 * (1 + TAX_RATE);
      totals[4] += total3;
      totals[5] += total3 * (1 + TAX_RATE);
    });

    // ØªØ­Ø¯ÙŠØ« Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
    document.getElementById('total1').textContent = totals[0].toFixed(2);
    document.getElementById('total1After').textContent = totals[1].toFixed(2);
    document.getElementById('total2').textContent = totals[2].toFixed(2);
    document.getElementById('total2After').textContent = totals[3].toFixed(2);
    document.getElementById('total3').textContent = totals[4].toFixed(2);
    document.getElementById('total3After').textContent = totals[5].toFixed(2);

    highlightMinPrices();
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹:', error);
    showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹', 'error');
  }
}

// ØªÙ…ÙŠÙŠØ² Ø£Ù‚Ù„ Ø³Ø¹Ø±
function highlightMinPrices() {
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø³Ø§Ø¨Ù‚
  document.querySelectorAll('.highlight').forEach(cell => {
    cell.classList.remove('highlight');
  });
  
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  
  rows.forEach(row => {
    const price1 = parseFloat(row.cells[4].querySelector('input').value) || 0;
    const price2 = parseFloat(row.cells[6].querySelector('input').value) || 0;
    const price3 = parseFloat(row.cells[8].querySelector('input').value) || 0;
    
    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµÙØ±ÙŠØ©
    const prices = [
      { value: price1, cells: [row.cells[4], row.cells[5]] },
      { value: price2, cells: [row.cells[6], row.cells[7]] },
      { value: price3, cells: [row.cells[8], row.cells[9]] }
    ].filter(p => p.value > 0);
    
    if (prices.length > 0) {
      const minPrice = Math.min(...prices.map(p => p.value));
      prices.forEach(p => {
        if (p.value === minPrice) {
          p.cells.forEach(cell => cell.classList.add('highlight'));
        }
      });
    }
  });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function showMessage(message, type = 'success') {
  const messageDiv = document.createElement('div');
  messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
  messageDiv.textContent = message;
  
  const container = document.querySelector('.container');
  container.insertBefore(messageDiv, container.firstChild);
  
  setTimeout(() => {
    messageDiv.remove();
  }, 3000);
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function saveData() {
  try {
    const data = {
      orderDate: document.getElementById('orderDate').value,
      supplier1Name: document.getElementById('supplier1Name').value,
      supplier2Name: document.getElementById('supplier2Name').value,
      supplier3Name: document.getElementById('supplier3Name').value,
      officer: document.getElementById('officer').value,
      head: document.getElementById('head').value,
      approved: document.getElementById('approved').value,
      committee1: document.getElementById('committee1').value,
      committee2: document.getElementById('committee2').value,
      committee3: document.getElementById('committee3').value,
      tableData: []
    };
    
    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
    document.querySelectorAll('#itemsTable tbody tr').forEach(row => {
      const rowData = {
        item: row.cells[1].querySelector('input').value,
        unit: row.cells[2].querySelector('input').value,
        qty: row.cells[3].querySelector('input').value,
        price1: row.cells[4].querySelector('input').value,
        price2: row.cells[6].querySelector('input').value,
        price3: row.cells[8].querySelector('input').value
      };
      data.tableData.push(rowData);
    });
    
    // Ø­ÙØ¸ ÙÙŠ localStorage
    const savedData = {
      tafData: data,
      savedAt: new Date().toISOString()
    };
    
    showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
    showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
function loadSavedData() {
  try {
    const savedData = JSON.parse(JSON.stringify({})); // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† main Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    const mainData = JSON.parse(JSON.stringify({})); // Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ÙŠØ§Ù†Ø§Øª main
    
    if (mainData && mainData.committeeDate) {
      document.getElementById('orderDate').value = mainData.committeeDate;
    }
    
    if (mainData && mainData.footer) {
      document.getElementById('officer').value = mainData.footer[0] || '';
      document.getElementById('head').value = mainData.footer[1] || '';
      document.getElementById('approved').value = mainData.footer[2] || '';
      document.getElementById('committee1').value = mainData.footer[3] || '';
      document.getElementById('committee2').value = mainData.footer[4] || '';
      document.getElementById('committee3').value = mainData.footer[5] || '';
    }
    
    if (mainData && mainData.table && mainData.table.length > 0) {
      mainData.table.forEach(rowData => {
        addRowFromMain(rowData);
      });
    }
  } catch (error) {
    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
  }
}

// Ø¥Ø¶Ø§ÙØ© ØµÙ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª main
function addRowFromMain(rowData) {
  rowCount++;
  const tbody = document.querySelector('#itemsTable tbody');
  const tr = document.createElement('tr');
  
  const item = rowData[1] || '';
  const unit = rowData[2] || '';
  const qty = parseFloat(rowData[3]) || 1;
  const price1 = parseFloat(rowData[4]) || 0;
  const price2 = parseFloat(rowData[5]) || 0;
  const price3 = parseFloat(rowData[6]) || 0;
  
  const total1 = qty * price1;
  const total2 = qty * price2;
  const total3 = qty * price3;
  
  const after1 = total1 * (1 + TAX_RATE);
  const after2 = total2 * (1 + TAX_RATE);
  const after3 = total3 * (1 + TAX_RATE);
  
  tr.innerHTML = `
    <td>${rowCount}</td>
    <td><input type="text" value="${item}" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td><input type="text" value="${unit}" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td><input type="number" value="${qty}" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td><input type="number" value="${price1}" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td class="calculated-cell">${after1.toFixed(2)}</td>
    <td><input type="number" value="${price2}" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td class="calculated-cell">${after2.toFixed(2)}</td>
    <td><input type="number" value="${price3}" min="0" step="0.01" oninput="updateRow(this)" style="width: 100%; border: none; text-align: center; background: transparent;"></td>
    <td class="calculated-cell">${after3.toFixed(2)}</td>
    <td><button class="remove-btn" onclick="removeRow(this)">Ù…Ø³Ø­</button></td>
  `;
  
  tbody.appendChild(tr);
  updateTotals();
}

// Ø¯Ø§Ù„Ø© Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ PDF Ø£Ùˆ Excel (ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
function exportData(format) {
  if (format === 'pdf') {
    window.print(); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙƒØ¨Ø¯ÙŠÙ„ Ù…Ø¤Ù‚Øª
  } else if (format === 'excel') {
    showMessage('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ØªØµØ¯ÙŠØ± Excel Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
  }
}

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
function searchTable(query) {
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  const searchTerm = query.toLowerCase();
  
  rows.forEach(row => {
    const item = row.cells[1].querySelector('input').value.toLowerCase();
    const unit = row.cells[2].querySelector('input').value.toLowerCase();
    
    if (item.includes(searchTerm) || unit.includes(searchTerm)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙˆÙ
function sortTable(columnIndex, direction = 'asc') {
  const tbody = document.querySelector('#itemsTable tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  
  rows.sort((a, b) => {
    let aVal, bVal;
    
    if (columnIndex === 1 || columnIndex === 2) {
      // Ø§Ù„Ù†Øµ
      aVal = a.cells[columnIndex].querySelector('input').value.toLowerCase();
      bVal = b.cells[columnIndex].querySelector('input').value.toLowerCase();
    } else {
      // Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
      aVal = parseFloat(a.cells[columnIndex].querySelector('input').value) || 0;
      bVal = parseFloat(b.cells[columnIndex].querySelector('input').value) || 0;
    }
    
    if (direction === 'asc') {
      return aVal > bVal ? 1 : -1;
    } else {
      return aVal < bVal ? 1 : -1;
    }
  });
  
  // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„ØµÙÙˆÙ Ù…Ø±ØªØ¨Ø©
  rows.forEach(row => tbody.appendChild(row));
  updateRowNumbers();
}

// Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function validateData() {
  const errors = [];
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  
  if (rows.length === 0) {
    errors.push('ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© ØµÙ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
  }
  
  rows.forEach((row, index) => {
    const item = row.cells[1].querySelector('input').value.trim();
    const unit = row.cells[2].querySelector('input').value.trim();
    const qty = parseFloat(row.cells[3].querySelector('input').value) || 0;
    
    if (!item) {
      errors.push(`Ø§Ù„ØµÙ ${index + 1}: Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ù…Ø·Ù„ÙˆØ¨`);
    }
    
    if (!unit) {
      errors.push(`Ø§Ù„ØµÙ ${index + 1}: Ø§Ù„ÙˆØ­Ø¯Ø© Ù…Ø·Ù„ÙˆØ¨Ø©`);
    }
    
    if (qty <= 0) {
      errors.push(`Ø§Ù„ØµÙ ${index + 1}: Ø§Ù„ÙƒÙ…ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±`);
    }
  });
  
  return errors;
}

// Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function calculateStatistics() {
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  let totalItems = 0;
  let totalQuantity = 0;
  let avgPrice1 = 0, avgPrice2 = 0, avgPrice3 = 0;
  let minPrice = Infinity, maxPrice = -Infinity;
  
  rows.forEach(row => {
    totalItems++;
    const qty = parseFloat(row.cells[3].querySelector('input').value) || 0;
    const price1 = parseFloat(row.cells[4].querySelector('input').value) || 0;
    const price2 = parseFloat(row.cells[6].querySelector('input').value) || 0;
    const price3 = parseFloat(row.cells[8].querySelector('input').value) || 0;
    
    totalQuantity += qty;
    avgPrice1 += price1;
    avgPrice2 += price2;
    avgPrice3 += price3;
    
    const prices = [price1, price2, price3].filter(p => p > 0);
    if (prices.length > 0) {
      minPrice = Math.min(minPrice, ...prices);
      maxPrice = Math.max(maxPrice, ...prices);
    }
  });
  
  return {
    totalItems,
    totalQuantity,
    avgPrice1: totalItems > 0 ? (avgPrice1 / totalItems).toFixed(2) : 0,
    avgPrice2: totalItems > 0 ? (avgPrice2 / totalItems).toFixed(2) : 0,
    avgPrice3: totalItems > 0 ? (avgPrice3 / totalItems).toFixed(2) : 0,
    minPrice: minPrice === Infinity ? 0 : minPrice.toFixed(2),
    maxPrice: maxPrice === -Infinity ? 0 : maxPrice.toFixed(2)
  };
}

// Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ (ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©)
function autoSave() {
  setInterval(() => {
    try {
      const data = {
        orderDate: document.getElementById('orderDate').value,
        supplier1Name: document.getElementById('supplier1Name').value,
        supplier2Name: document.getElementById('supplier2Name').value,
        supplier3Name: document.getElementById('supplier3Name').value,
        tableData: []
      };
      
      document.querySelectorAll('#itemsTable tbody tr').forEach(row => {
        const rowData = {
          item: row.cells[1].querySelector('input').value,
          unit: row.cells[2].querySelector('input').value,
          qty: row.cells[3].querySelector('input').value,
          price1: row.cells[4].querySelector('input').value,
          price2: row.cells[6].querySelector('input').value,
          price3: row.cells[8].querySelector('input').value
        };
        data.tableData.push(rowData);
      });
      
      // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ ØµØ§Ù…Øª
      console.log('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', new Date().toLocaleTimeString('ar-EG'));
    } catch (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error);
    }
  }, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
}

// Ø¨Ø¯Ø¡ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
document.addEventListener('DOMContentLoaded', function() {
  autoSave();
});

// Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…
window.addEventListener('error', function(event) {
  console.error('Ø®Ø·Ø£ Ø¹Ø§Ù…:', event.error);
  showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'error');
});

// ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
document.addEventListener('keydown', function(event) {
  // Ctrl + Enter Ù„Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
  if (event.ctrlKey && event.key === 'Enter') {
    event.preventDefault();
    addEmptyRow();
  }
  
  // Ctrl + S Ù„Ù„Ø­ÙØ¸
  if (event.ctrlKey && event.key === 's') {
    event.preventDefault();
    saveData();
  }
  
  // Ctrl + P Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
  if (event.ctrlKey && event.key === 'p') {
    event.preventDefault();
    window.print();
  }
});

// Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
function showHelpInfo() {
  const helpText = `
Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­:
- Ctrl + Enter: Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
- Ctrl + S: Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- Ctrl + P: Ø·Ø¨Ø§Ø¹Ø©

Ù…Ù„Ø§Ø­Ø¸Ø§Øª:
- ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø± Ù‡ÙŠ Ø§Ù„Ø£Ù‚Ù„ Ø³Ø¹Ø±Ø§Ù‹
- Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ø·Ø¨Ù‚: 15%
  `;
  
  alert(helpText);
}

// Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹)
console.log('Ù†Ø¸Ø§Ù… ØªÙØ±ÙŠØº Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
console.log('Ø§Ø³ØªØ®Ø¯Ù… showHelpInfo() Ù„Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©');

</script>

</body>
</html>